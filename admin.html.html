<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理者画面 - 予約設定</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .calendar-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; }
    table { border-collapse: collapse; margin: 10px auto; }
    th, td { width: 40px; height: 40px; border: 1px solid #ccc; text-align: center; cursor: pointer; }
    td.active { background: #b2fab4; }
    td.today { background: #ffe4b2; }
    .form-box { max-width: 300px; margin: 10px auto; background: white; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
    .form-box input { width: 100%; padding: 5px; margin: 5px 0; }
    .selected-date { text-align: center; font-weight: bold; margin: 10px 0; }
  </style>
</head>
<body>
<h1>管理者用：予約設定</h1>
<div class="calendar-container" id="calendarArea"></div>
<div class="selected-date" id="selectedDateLabel">日付を選択してください</div>

<div class="form-box">
  <label>初心者の上限人数：<input type="number" id="beginnerLimit" min="0"></label>
  <label>経験者の上限人数：<input type="number" id="experiencedLimit" min="0"></label>
  <button onclick="saveConfig()">この日付の設定を保存</button>
</div>

<script>
  const monthsToShow = 2;
  let selectedDate = null;
  const todayStr = new Date().toISOString().split('T')[0];

  function renderCalendars() {
    const container = document.getElementById('calendarArea');
    container.innerHTML = '';
    const today = new Date();
    for (let i = 0; i < monthsToShow; i++) {
      const date = new Date(today.getFullYear(), today.getMonth() + i, 1);
      container.appendChild(buildCalendar(date));
    }
  }

  function buildCalendar(baseDate) {
    const year = baseDate.getFullYear();
    const month = baseDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const config = JSON.parse(localStorage.getItem('config') || '{}');

    const table = document.createElement('table');
    const caption = document.createElement('caption');
    caption.textContent = `${year}年${month + 1}月`;
    table.appendChild(caption);
    const weekdays = ['日','月','火','水','木','金','土'];
    const headRow = document.createElement('tr');
    weekdays.forEach(d => {
      const th = document.createElement('th'); th.textContent = d; headRow.appendChild(th);
    });
    table.appendChild(headRow);

    let row = document.createElement('tr');
    for (let i = 0; i < firstDay.getDay(); i++) row.appendChild(document.createElement('td'));

    for (let d = 1; d <= lastDay.getDate(); d++) {
      const day = new Date(year, month, d);
      const dateStr = `${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
      const cell = document.createElement('td');
      cell.textContent = d;

      if (dateStr === todayStr) cell.classList.add('today');
      if (config[dateStr] && config[dateStr].enabled) cell.classList.add('active');

      cell.onclick = () => selectDate(dateStr, cell);
      row.appendChild(cell);
      if (day.getDay() === 6 || d === lastDay.getDate()) {
        table.appendChild(row);
        row = document.createElement('tr');
      }
    }
    return table;
  }

  function selectDate(dateStr, cell) {
    selectedDate = dateStr;
    document.getElementById('selectedDateLabel').textContent = `選択中の日付：${dateStr}`;
    document.querySelectorAll('td').forEach(td => td.classList.remove('selected'));
    cell.classList.add('selected');
    loadConfig(dateStr);
  }

  function loadConfig(dateStr) {
    const config = JSON.parse(localStorage.getItem('config') || '{}');
    const info = config[dateStr] || { enabled: false, beginner_limit: 0, experienced_limit: 0 };
    document.getElementById('beginnerLimit').value = info.beginner_limit;
    document.getElementById('experiencedLimit').value = info.experienced_limit;
  }

  function saveConfig() {
    if (!selectedDate) {
      alert('日付を選択してください');
      return;
    }
    const beginnerLimit = parseInt(document.getElementById('beginnerLimit').value || 0);
    const experiencedLimit = parseInt(document.getElementById('experiencedLimit').value || 0);
    const config = JSON.parse(localStorage.getItem('config') || '{}');
    config[selectedDate] = {
      enabled: true,
      beginner_limit: beginnerLimit,
      experienced_limit: experiencedLimit
    };
    localStorage.setItem('config', JSON.stringify(config));
    alert('保存しました');
    renderCalendars();
  }

  renderCalendars();
</script>
</body>
</html>
